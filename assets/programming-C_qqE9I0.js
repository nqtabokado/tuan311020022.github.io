import{s as l,q as a}from"./index-1OUVmTX5.js";import{i as r}from"./axios-DfgZ8BjE.js";async function w(){try{const t=await r.get("/workflows");return console.log(t.data),t.data}catch(t){throw t}}async function d(t){try{return(await r.post("/workflows",t)).data}catch(e){throw e}}async function g(t){try{return(await r.post("/workflows/run",t)).data}catch(e){throw e}}async function h(t){try{return(await r.post("/workflows/stop",t)).data}catch(e){throw e}}async function u(){try{return(await r.get("/workflows/status")).data}catch(t){throw t}}const k=l("programming",{state:()=>({workflows:{},isMeasurementRunning:!1,isOK:!1,isNG:!1,ioInputs:[0,0,0,0,0,0,0,0],ioOutputs:[0,0,0,0,0,0,0,0],pollingId:null,selectedModule:null}),getters:{hasRunning(t){return Object.values(t.workflows).some(e=>e.is_running===!0)},currentWorkflow(t){return t.selectedModule&&t.workflows[t.selectedModule]||null},isCurrentModuleRunning(){var t;return((t=this.currentWorkflow)==null?void 0:t.is_running)===!0}},actions:{async fetchWorkflowStatus(){try{const t=await u(),e=t.workflows||{};for(const[s,o]of Object.entries(e)){const n=this.workflows[s],i=a({is_running:o.is_running,screen:o.screen,mode:o.mode});n?(n.is_running!==o.is_running||n.screen!==o.screen||n.mode!==o.mode)&&(this.workflows[s]=i):this.workflows[s]=i}for(const s of Object.keys(this.workflows))e[s]||delete this.workflows[s];this.isMeasurementRunning=!!t.is_measurement_running,this.isOK=!!t.is_ok,this.isNG=!!t.is_ng,Array.isArray(t.io_inputs)&&(this.ioInputs=t.io_inputs),Array.isArray(t.io_outputs)&&(this.ioOutputs=t.io_outputs)}catch(t){console.error("[ProgrammingStore] fetchWorkflowStatus failed",t)}},startPolling(t=2e3){this.pollingId||(this.fetchWorkflowStatus(),this.pollingId=setInterval(this.fetchWorkflowStatus,t))},stopPolling(){this.pollingId&&(clearInterval(this.pollingId),this.pollingId=null)},selectModule(t){this.selectedModule=t,localStorage.setItem("selectedModule",t)},restoreSelectedModule(t){const e=localStorage.getItem("selectedModule");e&&t.includes(e)?this.selectedModule=e:t.length>0&&(this.selectedModule=t[0],localStorage.setItem("selectedModule",t[0]))}}});export{g as a,h as b,w as g,d as s,k as u};
