import{u as W,i as z}from"./order-C8kYxvwA.js";import{u as F}from"./programming-C_qqE9I0.js";import{d as P,e as N,f as M,o as c,c as r,g as k,b as e,t as m,k as U,T as j,l as B,m as D,p as E,a as I,F as L,i as Y,n as v,_ as A}from"./index-1OUVmTX5.js";import"./axios-DfgZ8BjE.js";const G={key:0,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.45)"}},H={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content rounded-4 shadow border-0"},K={class:"modal-body text-center py-4 px-3"},X={class:"fw-semibold mb-3"},Z={key:0,class:"text-muted small mb-0"},tt={class:"modal-footer justify-content-center border-0 pb-4 gap-2"},ot=P({__name:"ConfirmModal",props:{modelValue:{type:Boolean},payload:{}},emits:["update:modelValue"],setup(i,{emit:a}){const l=i,d=a,y=N(()=>l.modelValue);async function b(){if(l.payload)try{await l.payload.onConfirm()}finally{d("update:modelValue",!1)}}function f(){d("update:modelValue",!1)}return(C,s)=>{var g,_,u,p;return c(),M(j,{to:"body"},[y.value?(c(),r("div",G,[e("div",H,[e("div",J,[e("div",K,[e("h5",X,m((g=i.payload)==null?void 0:g.title),1),(_=i.payload)!=null&&_.desc?(c(),r("p",Z,m(i.payload.desc),1)):k("",!0)]),e("div",tt,[e("button",{type:"button",class:"btn px-4 fw-semibold text-white",style:{"background-color":"#6c757d"},onClick:f}," キャンセル "),e("button",{type:"button",class:"btn px-4 fw-semibold text-white",style:U({backgroundColor:((u=i.payload)==null?void 0:u.yesColor)||"#198754"}),onClick:b},m(((p=i.payload)==null?void 0:p.yesText)||"確認"),5)])])])])):k("",!0)])}}}),nt={class:"container pt-3"},et={class:"row g-3"},st={key:0,class:"running-badge"},at={class:"product-header"},it={class:"qty-control"},lt=["disabled","onClick"],dt=["disabled","onClick"],ct=["disabled","onClick"],ut=P({__name:"index",setup(i){const a=W(),l=F();let d=null;const y=B(!1),b=B(null);function f(o){b.value=o,y.value=!0}const C=N(()=>a.products);function s(o){return a.getRuntime(o)}D(async()=>{await a.fetchProducts(),l.startPolling(),d=z()}),E(()=>{d==null||d.close(),l.stopPolling()});function g(o){const t=s(o.id);if(t){if(t.quantity===0){f({title:"ロボット運転を開始しますか？",desc:"※ ロボットが動作を開始します",yesText:"開始",yesColor:"#198754",onConfirm:async()=>{a.setQuantity(o.id,o.module,1),t.onceRunning||(t.onceRunning=!0,await a.startOnce(o.module))}});return}a.setQuantity(o.id,o.module,t.quantity+1)}}function _(o){const t=s(o.id);if(t){if(t.quantity===1){f({title:"ロボット運転を停止しますか？",desc:"※ 残り数量に関係なく停止します",yesText:"停止",yesColor:"#dc3545",onConfirm:async()=>{a.setQuantity(o.id,o.module,0),t.onceRunning=!1,await a.stop(o.module)}});return}a.setQuantity(o.id,o.module,t.quantity-1)}}function u(o){const t=s(o.id);return(t==null?void 0:t.running)&&(t==null?void 0:t.mode)==="loop"}function p(o){const t=s(o.id);return(t==null?void 0:t.running)&&(t==null?void 0:t.mode)==="once"}function O(o){const t=s(o.id);if(!t)return;const n=t.mode==="loop";f({title:n?"ループ運転を停止しますか？":"ループ運転を開始しますか？",yesText:n?"停止":"開始",yesColor:n?"#dc3545":"#198754",onConfirm:async()=>{n?await a.stop(o.module):await a.startLoop(o.module)}})}return l.$subscribe((o,t)=>{a.applyWorkflowStatus(t)}),(o,t)=>(c(),r(L,null,[e("div",nt,[e("div",et,[(c(!0),r(L,null,Y(C.value,n=>{var h,w,x,q,$,V,R,S,Q;return c(),r("div",{key:n.id,class:"col-12 col-sm-6"},[e("div",{class:v(["product-card",{running:(h=s(n.id))==null?void 0:h.running}])},[(w=s(n.id))!=null&&w.running?(c(),r("div",st," 準備中 ")):k("",!0),e("div",at,[e("h2",null,m(n.name),1),e("div",{class:v(["robot-status",{running:(x=s(n.id))==null?void 0:x.robotRunning}])}," 状態: "+m((q=s(n.id))!=null&&q.robotRunning?"運転中":"待機中"),3)]),e("div",it,[e("button",{class:"btn btn-outline-secondary qty-btn",disabled:(($=s(n.id))==null?void 0:$.locked)||u(n),onClick:T=>_(n)},[...t[1]||(t[1]=[e("span",{class:"qty-icon"},"−",-1)])],8,lt),e("div",{class:v(["qty-number",{"qty-disabled":((V=s(n.id))==null?void 0:V.locked)||u(n)}])},m(((R=s(n.id))==null?void 0:R.quantity)??0),3),e("button",{class:"btn btn-outline-success qty-btn",disabled:((S=s(n.id))==null?void 0:S.locked)||u(n),onClick:T=>g(n)},[...t[2]||(t[2]=[e("span",{class:"qty-icon"},"＋",-1)])],8,dt),e("button",{class:v(["loop-btn",{active:(Q=s(n.id))==null?void 0:Q.loopRunning}]),disabled:p(n),onClick:T=>O(n)},[...t[3]||(t[3]=[e("i",{class:"bi bi-arrow-repeat"},null,-1)])],10,ct)])],2)])}),128))])]),I(ot,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),payload:b.value},null,8,["modelValue","payload"])],64))}}),bt=A(ut,[["__scopeId","data-v-000d4296"]]);export{bt as default};
